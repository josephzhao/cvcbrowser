{% extends 'SonataPageBundle::base_layout.html.twig' %}
{% block sonata_page_head %}
    {% block sonata_page_stylesheets %}
        {{parent()}}
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/leaflet.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/leaflet.map2u.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/Control.MiniMap.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/L.Control.MousePosition.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/leaflet.locationfilter.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/leaflet.draw.css" type="text/css" media="all" />
        <link rel="stylesheet" href="/bundles/map2uleaflet/css/L.Control.Sidebar.css" type="text/css" media="all" />
        <style>

            .sonata-bc .container {

                height: 100%;
            }
            .leaflet-sidebar #sidebar-left {
                overflow: auto;
            }
            .sonata-bc .narratives {
                margin: 25px 20px 30px 10px;

            }
            .sonata-bc .narratives > p {

                display: none;
            }

            .sonata-bc .citations {
                margin: 10px 20px 10px 10px;
                font-size: 0.8em;
                display: none;
            }
            .sonata-bc .narratives-view {
                /* margin: 25px 20px 0px 10px;*/
                margin-bottom: 5px;
                margin-right: 10px;
                position: absolute;
                float: right;
                bottom:10px;
                right:10px;
                cursor: pointer;
                border: 2px solid green;
                padding: 3px 5px;
                -moz-border-radius: 5px;
                opacity: 0.8; 
                background: lightskyblue;
                border-radius: 5px;
            }
            .sonata-bc .narratives-view:hover
            { 
                color:blue;

            }
            div.leafmap_title_tooltip {
                color: #222; 
                background: #fff; 
                padding: .5em; 
                text-shadow: #f5f5f5 0 1px 0;
                border-radius: 2px; 
                box-shadow: 0px 0px 2px 0px #a6a6a6; 
                opacity: 0.9; 
                z-index: 1002;
                position: absolute;
            }

        </style>

    {% endblock %}
    {% block sonata_page_javascripts %}
        {{parent()}}
        <script type="text/javascript">
            var narratives_items;
            var current_narratives = -1;

            var interval = 30 * 1000; // one second
            $(function() {

                narratives_items = d3.selectAll('#sidebar-left').selectAll('#sidebar_content .narratives').selectAll('div p')[0];
                //  alert(narratives_items.length);

//                setTimeout(display_each_narratives(), 30000);


                d3.timer(display_each_narratives(), interval);

                $('#narratives-view').click(function() {
                    // alert("1");alert($('#narratives-view').html());
                    if ($('#narratives-view').html() === 'View All')
                    {
                        for (var i = 0; i < narratives_items.length; i++)
                        {
                            $('#narratives-' + i).css('display', 'block');
                        }
                        $('.sonata-bc .citations').css('display', 'block');
                        $('#narratives-view').html('Close');
                    }
                    else
                    {
                        $('#narratives-0').css('display', 'block');
                        for (var i = 1; i < narratives_items.length; i++)
                        {
                            $('#narratives-' + i).css('display', 'none');
                        }
                        $('.sonata-bc .citations').css('display', 'none');

                        current_narratives = -1;
                        d3.timer(display_each_narratives(), interval);
                        $('#narratives-view').html('View All');
                    }

                });
            });

            function display_each_narratives() {

                //  alert(narratives_items[0]);

                if (current_narratives < narratives_items.length - 1 && narratives_items.length > 0)
                {
                    if (current_narratives > -1)
                        $('#narratives-' + current_narratives).css('display', 'none');
                    current_narratives = current_narratives + 1;
                    $('#narratives-' + current_narratives).css('display', 'block');
                }
                else {
                    if (narratives_items.length > 0)
                    {
                        $('#narratives-' + current_narratives).css('display', 'none');
                        current_narratives = 0;
                        $('#narratives-' + current_narratives).css('display', 'block');
                    }

                }
                //  alert(current_narratives + "   " + $('#narratives-' + current_narratives).height());

                $('.sonata-bc .narratives-view').css('top', $('#narratives-' + current_narratives).height() + 25);
                $('.sonata-bc .narratives-view').css('height', 18);

                // note that we're returning a new callback function each time
                return function() {

                    d3.timer(display_each_narratives(), interval);
                    return true;
                };
            }
            ;
            {# setTimeout(display_each_narratives(), 30000);

             }#}

                 window.SONATA_CONFIG = {
                     CONFIRM_EXIT: {% if admin_pool is defined and admin_pool.getOption('confirm_exit') %}true{% else %}false{% endif %},
                     USE_SELECT2: {% if admin_pool is defined and admin_pool.getOption('use_select2') %}true{% else %}false{% endif %}
                 };
                 window.SONATA_TRANSLATIONS = {
                     CONFIRM_EXIT: '{{ 'confirm_exit'|trans({}, 'SonataAdminBundle')|escape('js') }}'
                 };
        </script> 
        <script src="/bundles/sonataadmin/jquery/jquery.confirmExit.js" type="text/javascript"></script>    
        <script src="/bundles/sonataadmin/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
        <script src="/bundles/sonataadmin/x-editable/js/bootstrap-editable.min.js"></script>
        <script src="/bundles/sonataadmin/select2/select2.min.js" type="text/javascript"></script>
        <script src="/bundles/sonataadmin/base.js" type="text/javascript"></script>
        <script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?sensor=false&v=3.6"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.js?2"></script>
        <script src="/bundles/map2uleaflet/js/Control.MiniMap.js"></script>
        <script src="/bundles/map2uleaflet/js/L.Control.MousePosition.js"></script>
        <script src="/bundles/map2uleaflet/js/L.Control.Sidebar.js"></script>
        <script src="/bundles/map2ucore/js/zip.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="/bundles/map2uleaflet/js/simplify.js"></script>    

        {#    <script src="http://d3js.org/d3.v3.js"></script>
            <script src="http://d3js.org/queue.v1.min.js"></script>
            <script src="http://d3js.org/topojson.v1.js"></script>    
            <script src="{{ asset('bundles/map2uleaflet/js/TileLayer.d3_geoJSON.js') }}"></script>    
            #}


        {#     <script src="{{ asset('bundles/map2uleaflet/js/leaflet.d3.js') }}"></script>#}

        {# {% javascripts '@Map2uLeafletBundle/Resources/public/js/leaflet.js' 
     '@Map2uLeafletBundle/Resources/public/js/osm.js' 
     '@Map2uLeafletBundle/Resources/public/js/Control.MiniMap.js' 
     '@Map2uLeafletBundle/Resources/public/js/L.Control.MousePosition.js' 
     '@Map2uLeafletBundle/Resources/public/js/L.Control.Sidebar.js' 
     '@Map2uLeafletBundle/Resources/public/js/querystring.js' 
     '@Map2uLeafletBundle/Resources/public/js/application.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.map2u.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet-google.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.legend.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.layers.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.note.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.share.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.zoom.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.draw.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.locationfilter.js' 
     '@Map2uLeafletBundle/Resources/public/js/bootstrap.tooltip.js' 
     '@Map2uLeafletBundle/Resources/public/js/bootstrap.dropdown.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet.locate.js' 
     '@Map2uLeafletBundle/Resources/public/js/i18n.js' 
     '@Map2uLeafletBundle/Resources/public/js/leaflet_map.js'
     
     
         filter='yui_js' %}
             <script type="text/javascript" src="{{ asset_url }}"></script>
         {% endjavascripts %}#}

        <script src="/bundles/map2uleaflet/js/querystring.js"></script>
        <script src="/bundles/map2uleaflet/js/application.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.map2u.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet-google.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.key.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.legend.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.layers.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.note.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.share.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.zoom.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.draw.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.locationfilter.js"></script>
        <script src="/bundles/map2uleaflet/js/bootstrap.tooltip.js"></script>
        <script src="/bundles/map2uleaflet/js/bootstrap.dropdown.js"></script>
        <script src="/bundles/map2uleaflet/js/leaflet.label.js"></script>

        <script src="/bundles/map2uleaflet/js/leaflet.locate.js"></script>
        <script src="/bundles/map2uleaflet/js/osm.js"></script>
        <script src="/bundles/map2uleaflet/js/router.js"></script>
        <script src="/bundles/map2uleaflet/js/i18n.js"></script>
        <script src="/bundles/map2uleaflet/js/index/search.js"></script>
        <script src="/bundles/map2uleaflet/js/index/export.js"></script>
        <script src="/bundles/map2uleaflet/js/index/history.js"></script>
        <script src="/bundles/map2uleaflet/js/index/browse.js"></script>
        <script src="/bundles/yorkujuturna/js/leaflet_map.js" type="text/javascript"></script>
    {% endblock %}
{% endblock %}
{% block sonata_page_container %}


    {#  {% if page is defined %}
          <div class="row">
              {% if page.name != 'global'%}
                  {{ sonata_page_render_container('content_top', 'global') }}
              {% endif %}
              {{ sonata_page_render_container('content_top', page) }}
          </div>
      {% endif %}#}

    <div class="row">
        {% block page_content %}

            {% if content is defined %}
                {{ content|raw }}
            {% else %}
                {% set content = block('content') %}
                {% if content|length > 0 %}
                    {{ content|raw }}
                {% elseif page is defined %}
                    {{ sonata_page_render_container('content', page) }}
                {% endif %}
            {% endif %}
        {% endblock %}
    </div>

    {% if page is defined %}
        <div class="row">
            {{ sonata_page_render_container('content_bottom', page) }}

            {% if page.name != 'global'%}
                {{ sonata_page_render_container('content_bottom', 'global') }}
            {% endif %}
        </div>
    {% endif %}

{% endblock %}
