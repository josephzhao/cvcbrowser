{% extends sonata_block.templates.block_base %}

{% block block %}
    <nav class="navbar navbar-custom juturna-main_menu" role="navigation">
        <div>
            <div class="collapse navbar-collapse navbar-main-collapse">
                <div id="cms-block-8" class="cms-block cms-block-element environment_services">
                    <ul class="nav navbar-nav">
                        {#<li {% if app.session.get('current_menu')=='home' %} class="active" {% endif %}><a href="{{path('welcome_home')}}" >Home
                            </a>
                        </li>#}
                        <li class="dropdown"><a href="#" class="dropdown-toggle  {% if app.session.get('current_menu')=='well_being' %} active {% endif %}" data-toggle="dropdown">Well-Being
                                <b class="caret"></b></a>

                            <ul class="dropdown-menu multi-level">
                                {% if wellbeingdomains is defined %}
                                    {% for wellbeingdomain in wellbeingdomains %}
                                        <li  style="" class="dropdown-submenu">
                                            <a class="dropdown-toggle" href="#{#{path("homepage_ecosystems",{_locale:app.request.locale,id:wellbeingdomain.id})}#}">{{wellbeingdomain.name|title}}</a>
                                            {% set benefits = wellbeingdomain.indicatorbenefits %}
                                            {% if benefits | length > 0 %}
                                                <ul class="dropdown-menu">
                                                    {% for benefit in benefits %}
                                                        <li>
                                                            <a href="{{path('homepage_map',{'locale':app.request.locale,'view':'benefit','id':benefit.id})}}">{{benefit.title|title|truncate(22, true, ' ...')}}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}    
                                        </li>
                                    {% endfor %}
                                {% endif %}  
                            </ul>


                        </li>
                        <li id="ecosystems" class="dropdown"><a href="#" class="dropdown-toggle {% if app.session.get('current_menu')=='ecosystems' %} active {% endif %}" data-toggle="dropdown">Ecosystem Services
                                <b class="caret"></b></a>
                            <ul class="dropdown-menu multi-level">
                                {% if ecosystems is defined %}
                                    {% for ecosystem in ecosystems %}
                                        <li  style="" class="dropdown-submenu">
                                            <a class="dropdown-toggle" href="#{#{path("homepage_ecosystems",{_locale:app.request.locale,id:ecosystem.id})}#}">{{ecosystem.name|title}}</a>
                                            {% set benefits = ecosystem.indicatorbenefits %}
                                            {% if benefits | length > 0 %}
                                                <ul class="dropdown-menu">
                                                    {% for benefit in benefits %}
                                                        <li>
                                                            <a href="{{path('homepage_map',{'locale':app.request.locale,'view':'benefit','id':benefit.id})}}">{{benefit.title|title|truncate(22, true, ' ...')}}</a>
                                                        </li>
                                                    {% endfor %}
                                                </ul>
                                            {% endif %}    
                                        </li>
                                    {% endfor %}
                                {% endif %}  
                            </ul>
                        </li>

                        {#   <li {% if app.session.get('current_menu')=='map' %} class="active" {% endif %}><a href="{{path('homepage_map')}}" >Map
                               </a>
                           </li>#}
                        <li {% if app.session.get('current_menu')=='stories' %} class="active" {% endif %}><a href="{{path('homepage_map',{'locale':app.request.locale,'view':'stories'})}}{#{path('homepage_stories')}#}" >Your Stories
                            </a>
                        </li>
                        {% if app.request.attributes.get('_route')=='homepage_map' %}
                            <li id="viewingscale" class="dropdown"><a href="#" class="dropdown-toggle" data-toggle="dropdown">Viewing Scale
                                    <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    {% if mapbookmarks|length == 0 %}
                                        <li  style="" >
                                            <a  data-zoom="11" href="#">Watershed 1:250 000</a>
                                        </li>
                                        <li  style="" >
                                            <a  data-zoom="14"  href="#">Subwatershed 1:35 000</a>
                                        </li>
                                        <li  style="">
                                            <a  data-zoom="17"  href="#">Locale 1:4000</a>
                                        </li>
                                    {% else %}
                                        {% for mapbookmark in mapbookmarks %}
                                            <li  style="">
                                                <a data-center="{{mapbookmark.lat}},{{mapbookmark.lng}}"   data-zoom="{{mapbookmark.zoomLevel}}" href="#">{{mapbookmark.name}}  {{mapbookmark.scaleText}}</a>
                                            </li>
                                        {% endfor %}
                                    {% endif %}
                                    <li  style="">
                                        <a  data-zoom="0" href="#">Set Map Center</a>

                                    </li>
                                </ul>
                            </li>
                        {% endif %}
                        {# <li {% if app.session.get('current_menu')=='forum' %} class="active" {% endif %}><a href="{{path('ccdn_forum_user_category_index')}}" >Forum
                             </a>
                         </li>#}
                    </ul>
                    <ul class="nav navbar-nav pull-right">
                        <li><a href="/CVCHelpsystem.html" target="_blank"><i class="fa fa-question"></i>Help</a></li>
                        <li {% if app.session.get('current_menu')=='about_us' %} class="active" {% endif %}><a href="{{path('homepage_about_us')}}" >About
                            </a>
                        </li>
                        {#
                        <li {% if app.session.get('current_menu')=='contact_us' %} class="active" {% endif %}><a href="{{path('homepage_contact_us')}}" >Contact Us
                            </a>
                        </li>#}

                        {% if app.user %}
                            {#<li ><a href="{{ path('sonata_admin_dashboard') }}">{{app.user.username}}</a></li>#}


                            <li id="logged-in" class="dropdown">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">  <i class="fa fa-user fa-lg"></i> {{app.user.username}} </a>


                                <ul class="dropdown-menu pull-right" style="padding:10px;margin:0px;min-width: 150px;width: 200px;border:1px solid lightblue;border-radius: 0 0 4px 4px;">
                                    {% if app.security and app.security.token and is_granted('ROLE_SONATA_ADMIN') %}
                                        <li style="display: block;"><a href="{{ path('sonata_admin_dashboard',{locale:app.request.getLocale()}) }}" style="padding:5px;border: none;">Admin Dashboard</a></li>
                                        {% endif %}
                                        {#                                    <li style="display: block;"><a href="{{ path('sonata_user_change_password',{locale:app.request.getLocale()}) }}" style="padding:5px;border: none;">Change Password</a></li>#}
                                    <li style="display: block;"><a href="{{ path('useraccount_profile',{locale:app.request.getLocale()}) }}" style="padding:5px;border: none;">User Profile</a></li>
                                    <li class="divider" style="display: block;"></li>
                                    <li style="display: block;"><a href="{{ path('fos_user_security_logout',{locale:app.request.getLocale()}) }}" style="padding:5px;border: none;"><i class="fa fa-sign-out fa-lg" style="display: inline-block;"></i>Logout</a></li>
                                </ul>

                            </li>                 



                        {% else %}
                            <li class="login">
                                <a class="login-popdown-trigger" href="{{path('fos_user_security_login',{locale:app.request.getLocale()})}}">Login</a>
                                <div class="login-dropdown">
                                    {{ render(controller('Map2uCoreBundle:Security:loginform', {'ajax':true,locale:app.request.getLocale()})) }}
                                </div> 
                            </li>
                            {#                            <li class="locale">{{ locale_switcher() }}</li>#}
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </nav>

{% endblock %}